{% extends 'global/layout_form.html.twig' %}

{% set titlePage = 'page.empleados.title.hour' | trans %}
{% set menu = 'empleados' %}
{% set pathCancel = path('empleados_list') %}

{% block formContent %}
    <div class="znv-half">
        {{ form_row(form.empleado) }}
    </div>
    <div class="znv-half">
        {{ form_row(form.fecha) }}
    </div>
    <div class="znv-half mb-4">
        {{ form_row(form.numero) }}
    </div> 
    <div id="finForm" class="znv-half">
        {{ form_row(form.area) }}
    </div>     

    {# ## JQuery ## #}
    <script>        
        $(document).ready(function() {
            $('#save_hour_area').on('change', function(e) {
                var selectedArea = $(this).val();

                //console.log('Area: ' + selectedArea)
                if (selectedArea) {
                    loadAreaProperties(selectedArea);              
                }
            });
        })

        function loadAreaProperties(areaId) {
            if (areaId != null){                
                 $.ajax({
                    url: "{{ path('ajax_form_area') }}" + '/' + areaId,
                    type: "GET",
                    success: function (data) {
                        console.log(data)                    
                        let dataEmpleados = JSON.parse(data) ;
                        
                        //$('#save_hour_area').prop('disabled', 'disabled');
                        for (x of dataEmpleados) {
                            $('#finForm').after(`<div class="znv-half" style="display: none"><div class="znv-form-group"><label for="${x.name + "ai"}" class="required">${ x.name }</label><div class="znv-group"> <input type="text" id="${x.name + "ai"}" name="save_hourData[${x.name}]" value="${x.value}" required="required" class="znv-form-control"></div></div>`);
                        }
                    },
                    error: function (err) {
                        alert("An error ocurred while loading data ...");
                    }
                 });
            }
        } 
    </script>
{% endblock %}
